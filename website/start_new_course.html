

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/css/start_new_course.css" type="text/css">
    <title>New course</title>
</head>

<body>
<header>
    <div class="holder">
        <img class="dots" src="/static/img/dots.png" alt="dots">
        <a href="/courses">&larr; Go back</a>
    </div>

    <img class="logo" src="/static/img/aas-logo.png" alt="logo">
</header>
<div class="main-part">
    <h1>Add new course</h1>
    <form id="form">
        <p>Name of the course</p>
        <input type="text" class="input-big" id="courseNameInput" required oninput="typeNameOfTheCourse()">
        <p>Year of the course</p>
        <input type="text" class="input-big" id="yearNameInput" required oninput="typeNameOfTheYear()">
        <div class="date-choice-container">
            <div class="date-choice">
                <p>Start date</p>
                <p><input type="date" id="startDate" required oninput="dateFunction() "></p>
            </div>
            <div class="date-choice">
                <p>End date</p>
                <p><input type="date" id="endDate" required oninput="dateFunction()"></p>
            </div>
        </div>

        <p>Choose groups</p>
        <select id="groupInput" onchange="chooseGroup()">
            <option>Choose group</option>
        </select>
        <h2>Check your new course</h2>
        <div class="checking-container">
            <div class="checking">
                <p>Course name</p>
                <p><input type="text" id="courseNameOutput" required readonly></p>
            </div>
            <div class="checking">
                <p>Year of the course</p>
                <p><input type="text" id="yearNameOutput" required readonly></p>
            </div>
            <div class="checking">
                <p>Course groups</p>
                <p><input type="text" id="groupOutput" required readonly></p>
            </div>
        </div>
        <p>Course date</p>
        <p><input type="text" id="date" readonly required></p>
        <div id="validation-error-message" class="hidden">!</div>
        <input type="submit" value="Add the course" class="submit">
    </form>
</div>
<div id="footer">
    <p>Terms</p>
    <p>Privacy</p>
    <p>Docs</p>
    <p>Contact AAS support</p>
    <p>Manage cookies</p>
</div>

<script>
    fetch('/api/web/groups')
        .then(response => response.json())
        .then(data => {
            const groupIds = data.map(group => group.id);
            printDropdownOptions(groupIds);
        })
        .catch(error => console.error('Error fetching groups:', error));

    function chooseGroup() {
        let mylist = document.getElementById("groupInput");
        let field = document.getElementById("groupOutput");
        let option = mylist.options[mylist.selectedIndex].text;
        if (field.value.includes(option)) {
            field.value = field.value.replace(option + " ", "")
        } else {
            field.value += option + " ";
        }
        mylist.options[0].selected = 'selected';
    }

    function printDropdownOptions(array) {
        const selectElement = document.getElementById("groupInput");
        array.forEach(option => {
            const optionElement = document.createElement("option");
            optionElement.textContent = option;
            optionElement.value = option;
            selectElement.appendChild(optionElement);
        });
    }

    function typeNameOfTheCourse() {
        let mylist = document.getElementById("courseNameInput");
        let field = document.getElementById("courseNameOutput");
        field.value = mylist.value;
    }

    function typeNameOfTheYear() {
        let mylist = document.getElementById("yearNameInput");
        let field = document.getElementById("yearNameOutput");
        field.value = mylist.value;
    }

    function dateFunction() {
        let startDate = document.getElementById("startDate");
        let endDate = document.getElementById("endDate");
        let text = document.getElementById("date");
        text.value = "From " + startDate.value.toString() + " To " + endDate.value.toString();
    }

    document.getElementById("form").addEventListener("submit", function(event) {
        event.preventDefault();

        const courseName = document.getElementById("courseNameInput").value;
        const year = parseInt(document.getElementById("yearNameInput").value, 10);
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;
        const groups = document.getElementById("groupOutput").value.trim().split(" ");
        const validationErrorMessage = document.getElementById('validation-error-message');

        const courseData = {
            name: courseName,
            year: year,
            start_date: startDate,
            end_date: endDate,
            groups: groups
        };

        if (new Date(startDate) >= new Date(endDate)) {
            validationErrorMessage.textContent = "The start date should be before the end date";
            validationErrorMessage.classList.remove('hidden');
            console.log("The start date should be before the end date")
            return;
        }

        console.log('Submitting course data:', courseData);

        fetch('/api/web/course', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(courseData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
            })
            .then(data => {
                console.log('Course created:', data);
                window.location.href = "/courses";
            })
            .catch(error => console.error('Error creating course:', error));
    });
</script>

</body>
</html>