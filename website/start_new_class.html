

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/start_new_class.css" type="text/css">
    <title>New class</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, Helvetica, sans-serif;
    }

    .main-part {
        margin: 5rem;
    }

    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 2rem
    }

    header .logo {
        max-width: 7vw;
        width: auto;
        display: block;
    }

    header .dots {
        width: 3vw;
        height: 3vw;
    }

    .holder {
        display: flex;
    }

    .holder a {
        display: flex;
        align-items: end;
        padding-left: 3rem;
        color: #003787;
    }

    .main-part {
        margin: 5rem;
    }

    .main-part p, h1, h2 {
        margin-top: 1rem;
        margin-bottom: 1rem;
    }

    .input-big {
        width: 60%;
        height: 2rem
    }

    .checking-container{
        display: flex;
        column-gap: 1rem;
    }

    #roomOutput, #groupInput, #roomSelector, #startDateOutput, #endDateOutput{
        height: 2rem;
        width: 20vw;
    }

    #groupOutput{
        height: 2rem;
        width: 40vw;
    }

    button{
        height: 2rem;
        width: 10vw;
        background-color: #003787;
        color: #A5B8D4;
        border-radius: 0.5rem;
        border: none;
        margin-top: 2rem;
    }

    #footer {
        display: flex;
        justify-content: center;
        padding: 2rem;
        gap: 1rem;
        position: absolute;
        width: 100%;
        color: #00000078;
    }

    .sub-header{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #003787;
    }

    .sub-header img{
        height: 5vh;
        width: 5vh;
    }

    #date {
        display: flex;
        gap: 1rem;
    }

    #time-choice {
        display: flex;
        gap: 1rem;
    }

</style>
<body>
<header>
    <div class="holder">
        <img class="dots" src="img/dots.png" alt="dots">
        <a href="">&larr; Go back</a>
    </div>

    <img class="logo" src="img/aas-logo.png" alt="logo">
</header>
<div class="sub-header">
    <h1>Professional skills 1A</h1>
    <img src="img/plus.png" alt="plus">
    <h2>Start new class</h2>
</div>
<div class="main-part">
    <h1>Add new class description</h1>
    <form id="form">
        <p>Name of the class</p>
        <select id="roomSelector" onchange="chooseRoom()">
            <option>Choose room</option>
        </select>
        <p>Choose groups</p>
        <select id="groupInput" onchange="chooseGroup()">
            <option>Choose groups</option>
        </select>
        <div id="time-choice">
        <div class="date-choice">
            <p>Start date</p>
            <p><input type="datetime-local" id="startTime" required oninput="chooseStartTime()"></p>
        </div>
        <div class="date-choice">
            <p>End date</p>
            <p><input type="datetime-local" id="endTime" required oninput="chooseEndTime()"></p>
        </div>
        </div>
        <h2>Check your new class</h2>
        <div class="checking-container">
            <div class="checking">
                <p>Class name</p>
                <p><input type="text" id="roomOutput" required readonly></p>
            </div>
            <div class="checking">
                <p>Class groups</p>
                <p><input type="text" id="groupOutput" required readonly ></p>
            </div>
        </div>
        <div id="date">
        <div id="startDateContainer">
        <p>Class start date</p>
        <p><input type="text" id="startTimeOutput" readonly required></p>
        </div>
        <div id="endDateContainer">
        <p>Class end date</p>
        <p><input type="text" id="endTimeOutput" readonly required></p>
        </div>
        </div>
        <button type="submit">Add the class</button>
    </form>

</div>
<div id="footer">
    <p>Terms</p>
    <p>Privacy</p>
    <p>Docs</p>
    <p>Contact AAS support</p>
    <p>Manage cookies</p>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const urlCourseID = urlParams.get('courseID');

    fetch('/api/web/rooms')
        .then(response => response.json())
        .then(data2 => {
            const rooms = data2.map(spot => spot.room);
            console.log(rooms)
            printDropdownOptions(rooms, "roomSelector");
        })
        .catch(error => console.error('Error fetching rooms:', error));

    fetch(`/api/web/groups/by_course?courseID=${urlCourseID}`)
        .then(response => response.json())
        .then(data => {
            const groupIds = data.map(group => group.id);
            printDropdownOptions(groupIds, "groupInput");
        })
        .catch(error => console.error('Error fetching groups:', error));


    function chooseGroup() {
        let mylist = document.getElementById("groupInput");
        let field = document.getElementById("groupOutput");
        let option = mylist.options[mylist.selectedIndex].text;
        if (field.value.includes(option)) {
            field.value = field.value.replace(option + " ", "")
        } else {
            field.value += option + " ";
        }
        mylist.options[0].selected = 'selected';
    }

    function printDropdownOptions(array, elementId) {
        const selectElement = document.getElementById(elementId);
        array.forEach(option => {
            const optionElement = document.createElement("option");
            optionElement.textContent = option;
            optionElement.value = option;
            selectElement.appendChild(optionElement);
        });
    }

    function chooseRoom() {
        let mylist = document.getElementById("roomSelector");
        let field = document.getElementById("roomOutput");
        if (mylist.value != "Choose room") {
            field.value = mylist.value;
        }
    }

    function chooseEndTime() {
        let mylist = document.getElementById("endTime");
        let field = document.getElementById("endTimeOutput");
        field.value = mylist.value.replace("T", " ");
    }

    function chooseStartTime() {
        let mylist = document.getElementById("startTime");
        let field = document.getElementById("startTimeOutput");
        field.value = mylist.value.replace("T", " ");
    }

    document.getElementById("form").addEventListener("submit", function(event) {
        event.preventDefault();

        const room = document.getElementById("roomOutput").value;
        const courseID = parseInt(urlCourseID);
        const startTime = document.getElementById("startTimeOutput").value;
        const endTime = document.getElementById("endTimeOutput").value;
        const groups = document.getElementById("groupOutput").value.trim().split(" ");

        const classData = {
            course_id: courseID,
            start_time: startTime,
            end_time: endTime,
            room: room,
            groups: groups
        };

        console.log('Submitting course data:', classData);

        fetch('/api/web/class', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(classData)
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
            })
            .then(data => {
                console.log('Class created:', data);
                window.location.href = `/classes?courseID=${urlCourseID}`;
            })
            .catch(error => console.error('Error creating course:', error));
    });

</script>

</body>
</html>